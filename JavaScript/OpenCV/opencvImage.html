<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hello OpenCV.js</title>

</head>
<body>

<p id="status">OpenCV.js is loading...</p>
<p id="status_Library">Library.js is loading...</p>
<p id="status_Jquery">jquery.js is loading...</p>

<script language="JavaScript"  src="header/jquery-3.3.1.js" type="text/javascript"></script>
<script async src="header/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
<script async src="header/Library.js" onload="onLibraryReady();" type="text/javascript"></script>

<div>
	Bar: <input type="range" id="trackbar" value="50" min="0" max="100" step="1" oninput="callback()">
	<input type="text" id="BarValue" size="3" value="50"/>
    <br>
	<br>
	<img id="imageSrc" alt="No Image" />
    <div class="caption">imageSrc <input type="file" id="fileInput" name="file" /></div>
	<canvas id="canvasOutput" ></canvas>
    <div class="caption">canvasOutput</div>
	<button type="button" id="ExeBtn">Execute</button>
	<a href="#" id="button" class="card-link">Download Image</a>
	<br>
</div>

<script type="text/javascript">
	//opencv.js onload
	function onOpenCvReady() {
	  document.getElementById('status').innerHTML = 'OpenCV.js is ready.';
	};
	//own library onload
	function onLibraryReady() {
	  document.getElementById('status_Library').innerHTML = 'Library.js is ready.';
	};
	//Jquery function work
	$(document).ready(function(){
		document.getElementById('status_Jquery').innerHTML = 'jquery.js is ready.';
	});
	
	//img variable & file loading button variable
	let imgElement = document.getElementById('imageSrc');
	let inputElement = document.getElementById('fileInput');
	//file buttom onclick: img variable set img
	inputElement.addEventListener('change', (e) => {
	  imgElement.src = URL.createObjectURL(e.target.files[0]);
	}, false);

	//set bar callback function
	function callback(){
	let BarValue = document.getElementById('BarValue');
	let trackbar = document.getElementById('trackbar');
	BarValue.setAttribute('value', trackbar.value);
	return trackbar
	}
	
	document.getElementById('ExeBtn').onclick = function() {
		let mat = cv.imread(imgElement);
		let dst = new cv.Mat();

		//gray(mat,dst);
		//console.log(callback().value);
		//console.log(callback().max);

		
		resize(mat,dst,callback());
		

		
		cv.imshow('canvasOutput', dst);
		mat.delete();
		dst.delete();
	}


	//
	imgElement.onload =	function(){
	  

		//console.log(getFilePath());
	};
	document.getElementById('button').onclick = function() {
		this.href = document.getElementById("canvasOutput").toDataURL();
		this.download = "image.png";
	};
</script>

</body>
</html>